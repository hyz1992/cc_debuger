'use strict';Object['defineProperty'](exports,Symbol['toStringTag'],{'value':'Module'});const e=require('./_funcs-Dslqk85r.cjs'),n=require('fs-extra'),t=require('path'),s='cc_debuger_1.ts',i='cc_debuger_2_ugly.ts',r='ccdebuger.pako.min.js',a=t['join'](e['_funcs']['getCurPluginPath'](),'src/tools/',r),o=t['join'](e['_funcs']['getCurPluginPath'](),'runtime/',s),l=t['join'](e['_funcs']['getCurPluginPath'](),'runtime/',i),c=t['join'](Editor['Project']['path'],'assets',s),u=c+'.meta',g=t['join'](Editor['Project']['path'],'assets',i),d=g+'.meta',f=t['join'](Editor['Project']['path'],'assets',r),_=f+'.meta';let m,p;const y=async()=>{try{console['log']('['+e['_funcs']['getPluginName']()+']\x20Injecting\x20runtime\x20script...');let _0x9eb9cf=!0x1;for(let _0x4f6fde=0x0;_0x4f6fde<0x78&&(_0x9eb9cf=await Editor['Message']['request']('asset-db','query-ready'),!_0x9eb9cf);_0x4f6fde++)await e['_funcs']['waitForSeconds'](0x1);if(!_0x9eb9cf)return;{const _0x4e6330=n['readFileSync'](a,'utf-8');n['writeFileSync'](f,_0x4e6330,'utf-8'),console['log']('['+e['_funcs']['getPluginName']()+']\x20Runtime\x20script\x20written\x20to\x20'+f),await Editor['Message']['request']('asset-db','refresh-asset','db://assets/'+r);}{const _0x1bbf20=n['readFileSync'](l,'utf-8');n['writeFileSync'](g,_0x1bbf20,'utf-8'),console['log']('['+e['_funcs']['getPluginName']()+']\x20Runtime\x20script\x20written\x20to\x20'+g),await Editor['Message']['request']('asset-db','refresh-asset','db://assets/'+i);}{const _0xa2ccaa=n['readFileSync'](o,'utf-8');n['writeFileSync'](c,_0xa2ccaa,'utf-8'),console['log']('['+e['_funcs']['getPluginName']()+']\x20Runtime\x20script\x20written\x20to\x20'+c),await Editor['Message']['request']('asset-db','refresh-asset','db://assets/'+s);}}catch(_0x3ef6b8){console['error']('['+e['_funcs']['getPluginName']()+']\x20Error\x20injecting\x20runtime\x20script:',_0x3ef6b8);}},S=async()=>{try{console['log']('['+e['_funcs']['getPluginName']()+']\x20Removing\x20runtime\x20script...'),n['existsSync'](c)&&(n['unlinkSync'](c),console['log']('['+e['_funcs']['getPluginName']()+']\x20Runtime\x20script\x20removed:\x20'+c)),n['existsSync'](g)&&(n['unlinkSync'](g),console['log']('['+e['_funcs']['getPluginName']()+']\x20Runtime\x20script\x20removed:\x20'+g)),n['existsSync'](f)&&(n['unlinkSync'](f),console['log']('['+e['_funcs']['getPluginName']()+']\x20Runtime\x20script\x20removed:\x20'+f)),n['existsSync'](u)&&(n['unlinkSync'](u),console['log']('['+e['_funcs']['getPluginName']()+']\x20Meta\x20file\x20removed:\x20'+u)),n['existsSync'](d)&&(n['unlinkSync'](d),console['log']('['+e['_funcs']['getPluginName']()+']\x20Meta\x20file\x20removed:\x20'+d)),n['existsSync'](_)&&(n['unlinkSync'](_),console['log']('['+e['_funcs']['getPluginName']()+']\x20Meta\x20file\x20removed:\x20'+_)),await Editor['Message']['request']('asset-db','refresh-asset','db://assets/'+s),await Editor['Message']['request']('asset-db','refresh-asset','db://assets/'+i);}catch(_0x21631a){console['error']('['+e['_funcs']['getPluginName']()+']\x20Error\x20removing\x20runtime\x20script:',_0x21631a);}},{pathExistsSync:w,writeFileSync:$,readFileSync:b}=require('fs-extra'),v={async 'open_main'(){console['log']('点击打开主面板'),Editor['Panel']['open'](e['packageJSON']['name']);},async 'restart_self_ui'(){console['log']('收到消息restart_self_ui'),await Editor['Panel']['close'](e['packageJSON']['name']);const _0x14e5e6={[e['packageJSON']['name']+'.eval_panel']:!0x1,[e['packageJSON']['name']+'.log_panel']:!0x1,[e['packageJSON']['name']+'.dynamicTexture_panel']:!0x1,[e['packageJSON']['name']+'.localCache_panel']:!0x1};for(let _0xcf0b9 in _0x14e5e6)_0x14e5e6[_0xcf0b9]=await Editor['Panel']['has'](_0xcf0b9),_0x14e5e6[_0xcf0b9]&&Editor['Panel']['close'](_0xcf0b9);setTimeout(async()=>{console['log']('时间到重启'),await Editor['Panel']['open'](e['packageJSON']['name']);for(let _0x50fa36 in _0x14e5e6)_0x14e5e6[_0x50fa36]&&(await new Promise(_0x1a0d73=>{setTimeout(()=>{_0x1a0d73(null);},0x7d0);}),await Editor['Panel']['open'](_0x50fa36));},0x7d0);},async 'onBeforeBuild'(_0x1ae549){var _0x12c49e;const _0xb77116=null==(_0x12c49e=null==_0x1ae549?void 0x0:_0x1ae549['packages'])?void 0x0:_0x12c49e['cc_debuger_realtime'];return e['_funcs']['logToFile']('beforeBuild,构建配置:'+JSON['stringify'](_0xb77116??{},null,0x2)),await(async _0x5b9ca2=>{const _0x563803=null==_0x5b9ca2?void 0x0:_0x5b9ca2['cut_plugin_from_runtime'],_0xcf2ba5=null==_0x5b9ca2?void 0x0:_0x5b9ca2['bAutoStarPlugin'],_0x12c30e=null==_0x5b9ca2?void 0x0:_0x5b9ca2['serverAddress'];if(n['existsSync'](c)){if(m=n['readFileSync'](c,'utf-8'),p=n['readFileSync'](u,'utf-8'),_0x563803)await S();else{let _0x108652=n['readFileSync'](c,'utf-8')['replace'](/bAutoStart\s*=\s*(true|false)/,'bAutoStart\x20=\x20'+_0xcf2ba5);_0x108652=_0x108652['replace'](/plugin_server_address\s*=\s*([`"'])(.*?)\1/,'plugin_server_address\x20=\x20`'+_0x12c30e+'`'),n['writeFileSync'](c,_0x108652,'utf-8'),await Editor['Message']['request']('asset-db','refresh-asset','db://assets/'+s);}return 0x0;}})(_0xb77116);},async 'onAfterBuild'(_0xf35d35,_0x28e994,_0x2829b6,_0x358a5c){var _0x4f8506,_0x4a2d08;const _0xd46df0=null==(_0x4f8506=null==_0x358a5c?void 0x0:_0x358a5c['cache'])?void 0x0:_0x4f8506['applicationJS'],_0x1b93c1=null==(_0x4a2d08=null==_0x28e994?void 0x0:_0x28e994['packages'])?void 0x0:_0x4a2d08['cc_debuger_realtime'];if(_0xf35d35?e['_funcs']['logToFile']('构建成功，应用脚本路径:'+_0xd46df0):e['_funcs']['logToFile']('构建失败'),e['_funcs']['logToFile']('afterBuild,构建配置:'+JSON['stringify'](_0x1b93c1??{},null,0x2)),_0xf35d35){if(await w(_0xd46df0)){let _0x239430=b(_0xd46df0);_0x239430=_0x239430+'\x0a'+P,$(_0xd46df0,_0x239430);}}return(async _0x3f2410=>{console['log']('结束构建',null==p?void 0x0:p['length'],'cfg?.cut_plugin_from_runtime',null==_0x3f2410?void 0x0:_0x3f2410['cut_plugin_from_runtime']),(null==_0x3f2410?void 0x0:_0x3f2410['cut_plugin_from_runtime'])?await y():(m&&n['writeFileSync'](c,m,'utf-8'),p&&n['writeFileSync'](u,p,'utf-8'),await Editor['Message']['request']('asset-db','refresh-asset','db://assets/'+s));})(_0x1b93c1);}},P='\x0awindow[\x22cc_debuger_intercept_log\x22]\x20=\x20function(){\x0a\x20\x20if(!window[\x22cc_debuger_log_intercepted\x22]){\x0a\x20\x20\x20\x20window[\x22cc_debuger_log_intercepted\x22]\x20=\x20true;\x0a\x20\x20\x20\x20\x20\x20[\x22log\x22,\x20\x22warn\x22,\x20\x22error\x22].forEach(level\x20=>\x20{\x0a\x20\x20\x20\x20\x20\x20const\x20originalMethod\x20=\x20console[level];\x0a\x0a\x20\x20\x20\x20\x20\x20console[level]\x20=\x20(...args)\x20=>\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20if(window[\x22cc_debuger_handleLog\x22]){\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20window[\x22cc_debuger_handleLog\x22](level,\x20args);\x0a\x20\x20\x20\x20\x20\x20\x20\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20return\x20originalMethod.apply(console,\x20args);\x0a\x20\x20\x20\x20\x20\x20};\x0a\x20\x20\x20\x20});\x0a\x20\x20}\x0a}\x0awindow[\x22cc_debuger_intercept_log\x22]()\x0a';exports['load']=function(){console['log']('插件\x20['+e['packageJSON']['name']+']\x20已安装'),y();},exports['methods']=v,exports['unload']=function(){console['log']('插件\x20['+e['packageJSON']['name']+']\x20已卸载'),S();};