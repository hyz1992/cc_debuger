'use strict';const e={'name':'cc_debuger_realtime','version':'1.1.2'},t=require('path'),n=require('net'),{exec:r,spawn:o}=require('child_process'),s=require('fs-extra'),i=require('os'),c=require('http'),a=require('crypto'),l=require('url');exports['_funcs']=void 0x0,(_0x2bb420=>{function _0x4d6fe1(){return e['name'];}function _0x3a0c53(){return t['join'](Editor['Project']['path'],'extensions',e['name']);}_0x2bb420['getPluginName']=_0x4d6fe1,_0x2bb420['getPluginVersionName']=function(){const _0x284b95=_0x3a0c53()+'/version.txt';let _0x545621=s['readFileSync'](_0x284b95);if(_0x545621['toString']&&(_0x545621=_0x545621['toString']()),'string'==typeof _0x545621)_0x545621=_0x545621['trim'](),/^\d+(\.\d+)*$/['test'](_0x545621)||(_0x545621=e['version']);else _0x545621=e['version'];return _0x545621;},_0x2bb420['getAssetInfoByUuid']=async function(_0x17b75a){return Editor['Message']['request']('asset-db','query-asset-info',_0x17b75a);},_0x2bb420['getAssetMetaByUuid']=async function(_0x55849e){return Editor['Message']['request']('asset-db','query-asset-meta',_0x55849e);},_0x2bb420['getUuidByUrl']=async function(_0x1fa93a){return Editor['Message']['request']('asset-db','query-uuid',_0x1fa93a);},_0x2bb420['log_1']=function(..._0x671f78){_0x671f78['unshift']('[Plugin]'),console['log']['apply'](console,_0x671f78);},_0x2bb420['getCurPluginPath']=_0x3a0c53,_0x2bb420['waitForSeconds']=async function(_0x551219){return new Promise(_0x8f2df2=>{setTimeout(()=>{_0x8f2df2(null);},0x3e8*_0x551219);});},_0x2bb420['getAllSubpathsFromUrl']=function(_0x2d78e6){const _0xa975b9=_0x2d78e6['replace'](/^[^:]+:\/+/,'')['split']('/'),_0x40e215=[];let _0x2b6f6e='';for(let _0x31dbbb=0x0;_0x31dbbb<_0xa975b9['length'];_0x31dbbb++)_0x2b6f6e=(_0x2b6f6e?_0x2b6f6e+'/':'')+_0xa975b9[_0x31dbbb],_0x40e215['push'](_0x2b6f6e);return _0x40e215;},_0x2bb420['getIconOfResType']=function(_0x1bf889){return'cc.SpriteFrame'===_0x1bf889||'cc.Texture2D'===_0x1bf889||'cc.ImageAsset'===_0x1bf889?'image':'cc.Prefab'===_0x1bf889?'prefab':'cc.SceneAsset'===_0x1bf889?'scene':'cc.Material'===_0x1bf889?'material':'cc.EffectAsset'===_0x1bf889?'effect':'cc.AudioClip'===_0x1bf889?'audio-clip':'cc.AnimationClip'===_0x1bf889?'animation-clip':'cc.JsonAsset'===_0x1bf889?'json':'cc.TextAsset'===_0x1bf889?'text':'cc.BitmapFont'===_0x1bf889?'bitmap-font':'cc.TTFFont'===_0x1bf889?'ttf-font':'cc.ParticleAsset'===_0x1bf889?'particle':'cc.SpriteAtlas'===_0x1bf889?'sprite-atlas':'cc.VideoClip'===_0x1bf889?'video':'cc.Mesh'===_0x1bf889?'mesh':'sp.SkeletonData'===_0x1bf889?'spine-data':'cc.AnimationClip'===_0x1bf889?'animation-clip':'unknown';},_0x2bb420['getRuntimePreviewUrl']=async function(){return'http://localhost:'+await new Promise(_0x1e45ab=>{Editor['Message']['request']('server','query-port')['then'](_0x1c8e39=>{_0x1e45ab(_0x1c8e39);});})+'/';},_0x2bb420['openWebSiteUrl']=function(_0x5160e6){let _0x16f482;switch(i['platform']()){case'win32':_0x16f482='start\x20\x22\x22\x20\x22'+_0x5160e6+'\x22';break;case'darwin':_0x16f482='open\x20\x22'+_0x5160e6+'\x22';break;case'linux':_0x16f482='xdg-open\x20\x22'+_0x5160e6+'\x22';break;default:return void console['error']('Unsupported\x20platform:\x20'+i['platform']());}r(_0x16f482,(_0x493dcd,_0x17135c,_0x5c9799)=>{_0x493dcd?console['error']('执行命令时出错:\x20'+_0x493dcd):_0x5c9799&&console['error']('标准错误输出:\x20'+_0x5c9799);});},_0x2bb420['waitForElementMounted']=async function(_0x3d9309,_0xd04808=0x64,_0x1b31cf=0x32){return _0x3d9309['value']?_0x3d9309['value']:new Promise(function(_0x5439aa,_0x21d136){let _0x2d1647=0x0;const _0x21a85e=setInterval(()=>{_0x3d9309['value']?(_0x5439aa(_0x3d9309['value']),clearInterval(_0x21a85e)):_0x2d1647>=_0x1b31cf?clearInterval(_0x21a85e):_0x2d1647++;},_0xd04808);});},_0x2bb420['clamp']=function(_0x13313d,_0x14ee3a,_0x12568f){if(_0x13313d>_0x14ee3a)throw new Error('min\x20should\x20be\x20less\x20than\x20or\x20equal\x20to\x20max');return Math['min'](Math['max'](_0x12568f,_0x13313d),_0x14ee3a);};const _0x5e9d53=[];async function _0x4e30fb(_0x144804){try{return await s['ensureDir'](_0x144804),_0x144804;}catch(_0x45b63a){return console['error']('操作文件夹时出错:\x20'+_0x45b63a['message']),null;}}async function _0x1ccbb1(){const _0x55ecbd=_0x3a0c53()+'/cache',_0x19b565=_0x55ecbd+'/localServer.json';return await _0x4e30fb(_0x55ecbd),_0x19b565;}_0x2bb420['runCmdSpawn']=function(_0x2b7e3e,_0x4bb930,_0x169d10){return new Promise((_0x310447,_0x2c2421)=>{const _0x40d0b3=o(_0x2b7e3e,_0x4bb930,{'shell':!0x0,..._0x169d10});_0x5e9d53['push'](_0x40d0b3),_0x40d0b3['stdout']['on']('data',_0x470f43=>{console['log']('[runCmdSpawn]:\x20'+_0x470f43['toString']()['trim']());}),_0x40d0b3['stderr']['on']('data',_0x29932f=>{console['error']('[runCmdSpawn\x20Error]:\x20'+_0x29932f['toString']()['trim']());}),_0x40d0b3['on']('error',_0x2d781f=>{console['error']('[runCmdSpawn\x20Error]',_0x2d781f),_0x310447();}),_0x40d0b3['on']('exit',_0x2a7340=>{_0x5e9d53['splice'](_0x5e9d53['indexOf'](_0x40d0b3),0x1),console['log']('[runCmdSpawn]\x20Process\x20exited\x20with\x20code\x20'+_0x2a7340),_0x310447();});});},_0x2bb420['stopSpawnProcess']=function(){for(let _0x2c31e3 of _0x5e9d53)_0x2c31e3['kill']();_0x5e9d53['length']=0x0;},_0x2bb420['rgbaToHex']=function(_0x4b12c2,_0x1af315,_0x58b234,_0x2a491b){const _0xc2e108=_0x2a71f9=>{const _0x5a02cf=_0x2a71f9['toString'](0x10);return 0x1===_0x5a02cf['length']?'0'+_0x5a02cf:_0x5a02cf;};return'#'+_0xc2e108(_0x4b12c2)+_0xc2e108(_0x1af315)+_0xc2e108(_0x58b234)+_0xc2e108(_0x2a491b);},_0x2bb420['findAvailablePort']=function _0x3c5777(_0x58f5e5){return new Promise((_0x298a74,_0xf5c8a9)=>{const _0x525b80=n['createServer']();_0x525b80['unref'](),_0x525b80['on']('error',()=>{_0x298a74(_0x3c5777(_0x58f5e5+0x1));}),_0x525b80['listen'](_0x58f5e5,()=>{const _0x5dbac1=_0x525b80['address']()['port'];_0x525b80['close'](()=>_0x298a74(_0x5dbac1));});});},_0x2bb420['roundNumbersToPrecision']=function _0x239536(_0x2d05dc,_0x2394c5=0x2){return null===_0x2d05dc||'object'!=typeof _0x2d05dc?'number'==typeof _0x2d05dc?Number(_0x2d05dc['toFixed'](_0x2394c5)):_0x2d05dc:Array['isArray'](_0x2d05dc)?_0x2d05dc['map'](_0x56e0b0=>_0x239536(_0x56e0b0,_0x2394c5)):Object['keys'](_0x2d05dc)['reduce']((_0x318bc3,_0x5b9358)=>{const _0x48a553=_0x2d05dc[_0x5b9358];return _0x318bc3[_0x5b9358]='number'==typeof _0x48a553?Number(_0x48a553['toFixed'](_0x2394c5)):'object'==typeof _0x48a553&&null!==_0x48a553?_0x239536(_0x48a553,_0x2394c5):_0x48a553,_0x318bc3;},{});},_0x2bb420['checkMouseIsInElemen']=function(_0x1e1e51,_0x2cc54f){const _0x1c1bd3=_0x1e1e51['getBoundingClientRect']();return _0x2cc54f['clientX']>_0x1c1bd3['x']&&_0x2cc54f['clientX']<_0x1c1bd3['x']+_0x1c1bd3['width']&&_0x2cc54f['clientY']>_0x1c1bd3['y']&&_0x2cc54f['clientY']<_0x1c1bd3['y']+_0x1c1bd3['height'];},_0x2bb420['registerF5']=function(){window['addEventListener']('keyup',_0x177fa4=>{'F5'==_0x177fa4['key']&&Editor['Message']['send'](_0x2bb420['getPluginName'](),'restart-self');});},_0x2bb420['isValidURL']=function(_0x2bcd1e){return new RegExp('^(?!mailto:)(?:(?:http|https|ftp)://|//)(?:\x5cS+(?::\x5cS*)?@)?(?:(?:(?:[1-9]\x5cd?|1\x5cd\x5cd|2[01]\x5cd|22[0-3])(?:\x5c.(?:1?\x5cd{1,2}|2[0-4]\x5cd|25[0-5])){2}(?:\x5c.(?:[0-9]\x5cd?|1\x5cd\x5cd|2[0-4]\x5cd|25[0-4]))|(?:(?:[a-z\x5cu00a1-\x5cuffff0-9]+-?)*[a-z\x5cu00a1-\x5cuffff0-9]+)(?:\x5c.(?:[a-z\x5cu00a1-\x5cuffff0-9]+-?)*[a-z\x5cu00a1-\x5cuffff0-9]+)*(?:\x5c.(?:[a-z\x5cu00a1-\x5cuffff]{2,})))|localhost)(?::\x5cd{2,5})?(?:(/|\x5c?|#)[^\x5cs]*)?$','i')['test'](_0x2bcd1e);},_0x2bb420['ensureFloderExist']=_0x4e30fb,_0x2bb420['getLocalIpv4IP']=function(){const _0x2b533f=i['networkInterfaces']();for(const _0x129123 in _0x2b533f){const _0x3f9587=_0x2b533f[_0x129123];for(const _0x50535a of _0x3f9587)if('IPv4'===_0x50535a['family']&&!_0x50535a['internal'])return _0x50535a['address'];}return'未找到\x20IP\x20地址';},_0x2bb420['getLocalIPs']=function(){const _0x1dcf70=i['networkInterfaces'](),_0x1dd2ac=[];for(const _0x2643b6 of Object['keys'](_0x1dcf70))for(const _0xff2ea3 of _0x1dcf70[_0x2643b6])'IPv4'!==_0xff2ea3['family']||_0xff2ea3['internal']||_0x1dd2ac['push'](_0xff2ea3['address']),'IPv6'!==_0xff2ea3['family']||_0xff2ea3['internal']||_0x1dd2ac['push'](_0xff2ea3['address']);return _0x1dd2ac;},_0x2bb420['checkIpIsLocalhost']=function(_0x5d5bd6){const _0x29e3da=_0x2bb420['getLocalIPs']();return!('localhost'!=_0x5d5bd6&&'::1'!=_0x5d5bd6&&'127.0.0.1'!=_0x5d5bd6&&!_0x29e3da['includes'](_0x5d5bd6));},_0x2bb420['getFs']=function(){return s;},_0x2bb420['getLocalServerJsonPath']=_0x1ccbb1,_0x2bb420['saveCustomServerAddress']=async function(_0x566378){const _0xd9567c=await _0x1ccbb1();let _0x235dc7=null;try{_0x235dc7=s['readJSONSync'](_0xd9567c);}catch(_0x156e92){}_0x235dc7={'ip':null==_0x235dc7?void 0x0:_0x235dc7['ip'],'port':null==_0x235dc7?void 0x0:_0x235dc7['port'],'ws':_0x566378},_0x235dc7['ip']||delete _0x235dc7['ip'],_0x235dc7['port']||delete _0x235dc7['port'],s['writeFileSync'](_0xd9567c,JSON['stringify'](_0x235dc7,null,0x4));};let _0x4ce2ce=0x0;function _0x9720a3(_0xecaa2a,_0x5e754f){const _0x234063=new Uint8Array(_0xecaa2a['length']);for(let _0x2877bd=0x0;_0x2877bd<_0xecaa2a['length'];_0x2877bd++)_0x234063[_0x2877bd]=_0xecaa2a[_0x2877bd]^_0x5e754f[_0x2877bd%_0x5e754f['length']];return _0x234063;}function _0x31c9c8(_0x4ca7cd){return l['parse'](_0x4ca7cd)['pathname'];}function _0x49a7d9(_0x42e3e9){const _0x2d6c9c=a['createHash']('md5');return _0x2d6c9c['update'](_0x42e3e9),_0x2d6c9c['digest']('hex');}_0x2bb420['printTime']=function(_0x135e1c,..._0x5ed52f){let _0x9d1e52=Date['now']();0x0==_0x4ce2ce||console['log'](_0x135e1c,_0x9d1e52-_0x4ce2ce,..._0x5ed52f),_0x4ce2ce=_0x9d1e52;},_0x2bb420['getI18nText']=function(_0x512fe5){_0x512fe5=_0x4d6fe1()+'.'+_0x512fe5;let _0x415773=Editor['I18n']['t'](_0x512fe5);return''==_0x415773&&_0x2bb420['log_1']('i18n.'+_0x512fe5+'为空'),_0x415773;},_0x2bb420['formatStr']=function(_0x4b292c,..._0x11182e){return _0x4b292c['replace'](/\{(\d+)\}/g,function(_0x23d093,_0x568a67){return void 0x0!==_0x11182e[_0x568a67]?_0x11182e[_0x568a67]:_0x23d093;});},_0x2bb420['formatDate']=function(_0x3829ca,_0x21e8f2){let _0x2f7dfa=new Date();null!=_0x21e8f2&&_0x2f7dfa['setTime'](_0x21e8f2);var _0x38d492={'M+':_0x2f7dfa['getMonth']()+0x1,'d+':_0x2f7dfa['getDate'](),'h+':_0x2f7dfa['getHours'](),'m+':_0x2f7dfa['getMinutes'](),'s+':_0x2f7dfa['getSeconds'](),'q+':Math['floor']((_0x2f7dfa['getMonth']()+0x3)/0x3),'S':_0x2f7dfa['getMilliseconds']()};for(var _0xecbc13 in(/(y+)/['test'](_0x3829ca)&&(_0x3829ca=_0x3829ca['replace'](RegExp['$1'],(_0x2f7dfa['getFullYear']()+'')['substr'](0x4-RegExp['$1']['length']))),_0x38d492))new RegExp('('+_0xecbc13+')')['test'](_0x3829ca)&&(_0x3829ca=_0x3829ca['replace'](RegExp['$1'],0x1==RegExp['$1']['length']?_0x38d492[_0xecbc13]:('00'+_0x38d492[_0xecbc13])['substr']((''+_0x38d492[_0xecbc13])['length'])));return _0x3829ca;},_0x2bb420['openEvalPanel']=async function(_0x14918d=''){const _0x3a60d6=_0x2bb420['getPluginName']()+'.eval_panel';await Editor['Panel']['has'](_0x3a60d6)?Editor['Panel']['focus'](_0x3a60d6):await Editor['Panel']['open'](_0x3a60d6),_0x14918d&&Editor['Message']['request'](_0x2bb420['getPluginName'](),'setDefaultEvalStr',_0x14918d);},_0x2bb420['parseKey']=function(_0x5df6a8){let _0x3ae1ac='';for(let _0x394720=0x0;_0x394720<_0x5df6a8['length'];_0x394720++){let _0x248ebf=_0x5df6a8[_0x394720]['toString'](),_0x525faf='';for(let _0x891a84=0x0;_0x891a84<_0x248ebf['length'];_0x891a84++)_0x525faf+=(0x9-parseInt(_0x248ebf['charAt'](_0x891a84)))['toString']();_0x3ae1ac+=parseInt(_0x525faf)['toString'](0x10)['padStart'](0x8,'0');}return _0x3ae1ac;},_0x2bb420['str_encrypt']=function(_0x53bba4,_0x4ce36f){if(null==_0x4ce36f)return void console['log']('key\x20不能为空');const _0x4da0ea=_0x9720a3(new TextEncoder()['encode'](_0x53bba4),new TextEncoder()['encode'](_0x4ce36f));let _0x13fdc5='';for(let _0x171f1d=0x0;_0x171f1d<_0x4da0ea['length'];_0x171f1d+=0x8000){const _0xd94dcc=_0x4da0ea['subarray'](_0x171f1d,_0x171f1d+0x8000);_0x13fdc5+=String['fromCharCode']['apply'](null,Array['from'](_0xd94dcc));}return btoa(_0x13fdc5);},_0x2bb420['str_decrypt']=function(_0x4eba9e,_0x3b3a53){if(null==_0x3b3a53)return void console['log']('key\x20不能为空');const _0x1bfe11=atob(_0x4eba9e),_0x56667d=new Uint8Array(_0x1bfe11['length']);for(let _0x596b64=0x0;_0x596b64<_0x1bfe11['length'];_0x596b64+=0x8000){const _0x1abeeb=_0x1bfe11['slice'](_0x596b64,_0x596b64+0x8000);for(let _0x9ac17a=0x0;_0x9ac17a<_0x1abeeb['length'];_0x9ac17a++)_0x56667d[_0x596b64+_0x9ac17a]=_0x1abeeb['charCodeAt'](_0x9ac17a);}const _0x3f7425=_0x9720a3(_0x56667d,new TextEncoder()['encode'](_0x3b3a53));return new TextDecoder()['decode'](_0x3f7425);},_0x2bb420['pako_deflate']=function(_0x526e4b){return pako['deflate'](_0x526e4b,{'to':'string'});},_0x2bb420['pako_inflate']=function(_0x541452){return pako['inflate'](_0x541452,{'to':'string'});},_0x2bb420['getDesignResolutionSize']=function(){var _0x186ac2,_0x5a82a1;const _0x1bd2a5=t['join'](Editor['Project']['path'],'settings/v2/packages/project.json');if(s['existsSync'](_0x1bd2a5))try{const _0x302dce=s['readJSONSync'](_0x1bd2a5);if(null==(_0x186ac2=null==_0x302dce?void 0x0:_0x302dce['general'])?void 0x0:_0x186ac2['designResolution'])return null==(_0x5a82a1=null==_0x302dce?void 0x0:_0x302dce['general'])?void 0x0:_0x5a82a1['designResolution'];}catch(_0x2e114f){}return null;},_0x2bb420['getMethodOfUrl']=_0x31c9c8,_0x2bb420['str_to_md5']=_0x49a7d9;function _0x195a92(_0x575033,_0x183ee2,_0x25d6d1=null){_0x25d6d1=_0x25d6d1||'7FC7F4BE5C4E543E0F3439095EE00A95';let _0x2c7e0c='',_0x4f8ce=[];for(let _0x56138c in _0x183ee2)_0x4f8ce['push'](_0x56138c);_0x4f8ce['sort']((_0x558ca6,_0xe3677d)=>_0x558ca6>_0xe3677d?0x1:-0x1);for(let _0x575de7 of _0x4f8ce){let _0x32c988=_0x183ee2[_0x575de7];0x0!=_0x2c7e0c['length']&&(_0x2c7e0c+='&'),'object'==typeof _0x32c988&&(_0x32c988=JSON['stringify'](_0x32c988)),_0x2c7e0c+=_0x575de7+'='+_0x32c988;}return _0x49a7d9(_0x575033+';'+_0x2c7e0c+';'+_0x25d6d1);}_0x2bb420['make_sign_of_method']=_0x195a92,_0x2bb420['sendPostRequest']=async function(_0x3fa123,_0x3e6b6c,_0x2e6e39=!0x1){return new Promise((_0x5d3d39,_0x392974)=>{if(_0x2e6e39){const _0x369e89=_0x195a92(_0x31c9c8(_0x3fa123),_0x3e6b6c);_0x3e6b6c['sign']=_0x369e89;}const _0x2862c2=JSON['stringify'](_0x3e6b6c),_0x13b777={'method':'POST','headers':{'Content-Type':'application/json','Content-Length':Buffer['byteLength'](_0x2862c2)}},_0x104659=c['request'](_0x3fa123,_0x13b777,_0x33a3ca=>{let _0x5566b7='';_0x33a3ca['on']('data',_0x42bda4=>{_0x5566b7+=_0x42bda4;}),_0x33a3ca['on']('end',()=>{if(_0x33a3ca['statusCode']>=0xc8&&_0x33a3ca['statusCode']<0x12c)try{_0x5d3d39(JSON['parse'](_0x5566b7));}catch(_0x4b2a36){_0x5d3d39(_0x5566b7);}else _0x392974(new Error('Request\x20failed\x20with\x20status\x20code\x20'+_0x33a3ca['statusCode']));});});_0x104659['on']('error',_0x379d4a=>{_0x392974(_0x379d4a);}),_0x104659['write'](_0x2862c2),_0x104659['end']();});},_0x2bb420['logToFile']=function(_0x364f2e,_0x5ef095){_0x5ef095||(_0x5ef095=t['join'](_0x2bb420['getCurPluginPath'](),'logs','cc_debuger_realtime.log')),_0x2bb420['ensureFloderExist'](t['dirname'](_0x5ef095)),s['appendFileSync'](_0x5ef095,_0x2bb420['formatDate']('yyyy-MM-dd\x20hh:mm:ss')+':\x20'+_0x364f2e+'\x0a');},_0x2bb420['checkNodeJsEnable']=async function(){r('node\x20-v',(_0x18102a,_0x5678c8,_0x3ec2f8)=>{if(_0x18102a)return void console['error']('Node.js\x20未安装或未正确配置，请安装\x20Node.js：https://nodejs.org/');const _0x1e1b6f=_0x5678c8['trim']();try{parseInt(_0x1e1b6f['replace'](/^[v,V]/,'')['split']('.')[0x0],0xa)>=0x12?_0x2bb420['log_1']('Node.js\x20版本：',_0x1e1b6f):console['error']('[cc_debuger_realtime]','Node.js\x20版本过低，可能无法正常使用插件，需要\x20>=\x20v18，当前为：',_0x1e1b6f);}catch(_0x223a6a){}});};})(exports['_funcs']||(exports['_funcs']={})),(function(){if(null!=globalThis['pako'])return;let _0x1c9b7d=t['join'](exports['_funcs']['getCurPluginPath'](),'src/tools/','ccdebuger.pako.min.js'),_0x54cb53=s['readFileSync'](_0x1c9b7d,'utf-8');try{new Function(_0x54cb53)();}catch(_0xb0604b){console['log'](_0xb0604b);}}()),exports['packageJSON']=e;